<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Snake</title>
<style>
:root{--bg:#0f172a;--panel:#111827;--text:#e5e7eb;--muted:#94a3b8;--accent:#22c55e}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);font-family:Inter,Segoe UI,system-ui,Arial,sans-serif;display:grid;place-items:center;min-height:100vh}
.wrap{background:var(--panel);border:1px solid #1f2937;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:14px}
.top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.score{font-weight:700}
canvas{background:#057a2e;border-radius:12px;display:block;max-width:100%;height:auto}
.actions{display:flex;gap:10px;margin-top:10px}
button{font:600 14px Segoe UI;padding:10px;border:none;border-radius:10px;background:var(--accent);color:#051c10;cursor:pointer}
.ghost{background:#1f2937;color:var(--text)}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="score"><span id="score">Score: 0</span> &nbsp; <span id="hi">High Score: 0</span></div>
    <div class="muted">WASD / Arrow keys</div>
  </div>
  <canvas id="game" width="600" height="600"></canvas>
  <div class="actions">
    <button onclick="reset()">Reset</button>
    <a class="ghost" href="index.html" style="text-decoration:none;text-align:center">Back</a>
  </div>
</div>
<script>
const canvas=document.getElementById('game')
const ctx=canvas.getContext('2d')
const size=20
const cols=canvas.width/size
const rows=canvas.height/size

let snake=[{x:Math.floor(cols/2), y:Math.floor(rows/2)}]
let dir={x:1,y:0}
let moveQueue=[]
let food=randFood()
let score=0
let hi=localStorage.getItem('snake_hi')||0
let speed=120
let timer=null

document.addEventListener('keydown',e=>{
  const k=e.key
  if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(k)) e.preventDefault()
  let nd=null
  if(k==='ArrowUp'||k==='w') nd={x:0,y:-1}
  else if(k==='ArrowDown'||k==='s') nd={x:0,y:1}
  else if(k==='ArrowLeft'||k==='a') nd={x:-1,y:0}
  else if(k==='ArrowRight'||k==='d') nd={x:1,y:0}
  if(nd){
    const last=moveQueue.length?moveQueue[moveQueue.length-1]:dir
    if(!(nd.x===-last.x && nd.y===-last.y)){
      moveQueue.push(nd)
    }
  }
})

function randFood(){
  let f
  do{
    f={x:Math.floor(Math.random()*cols), y:Math.floor(Math.random()*rows)}
  }while(snake.some(s=>s.x===f.x && s.y===f.y))
  return f
}

function reset(){
  start()
}

function start(){
  clearInterval(timer)
  dir={x:0,y:0}
  moveQueue=[]
  snake=[{x:Math.floor(cols/2), y:Math.floor(rows/2)}]
  food=randFood()
  score=0
  speed=120
  updateHud()
  timer=setInterval(tick, speed)
}

function updateHud(){
  document.getElementById('score').textContent='Score: '+score
  document.getElementById('hi').textContent='High Score: '+hi
}

function tick(){
  if(moveQueue.length) dir=moveQueue.shift()
  if(dir.x===0 && dir.y===0){draw();return}
  const head={x:snake[0].x+dir.x, y:snake[0].y+dir.y}
  // Removed start check as dir is never 0,0 now (unless explicitly set, but we set 1,0)
  
  if(head.x<0||head.x>=cols||head.y<0||head.y>=rows){gameOver();return}
  if(snake.some(s=>s.x===head.x && s.y===head.y)){gameOver();return}

  snake.unshift(head)
  if(head.x===food.x && head.y===food.y){
    score+=10
    if(score>hi) {
      hi=score
      localStorage.setItem('snake_hi', hi)
    }
    food=randFood()
    speed=Math.max(60,speed-2)
    clearInterval(timer)
    timer=setInterval(tick, speed)
    updateHud()
  }else{
    snake.pop()
  }
  draw()
}

function gameOver(){
  clearInterval(timer)
  ctx.fillStyle='rgba(0,0,0,0.5)'
  ctx.fillRect(0,0,canvas.width,canvas.height)
  ctx.fillStyle='#fff'
  ctx.font='bold 48px Inter, sans-serif'
  ctx.textAlign='center'
  ctx.textBaseline='middle'
  ctx.fillText('Game Over', canvas.width/2, canvas.height/2)
  ctx.font='20px Inter, sans-serif'
  ctx.fillText('Press Reset to Play Again', canvas.width/2, canvas.height/2+40)
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height)
  // food
  ctx.fillStyle='#e11d48'
  ctx.beginPath()
  ctx.arc(food.x*size+size/2, food.y*size+size/2, size/2-2, 0, Math.PI*2)
  ctx.fill()
  // snake
  for(let i=snake.length-1;i>=0;i--){
    const s=snake[i]
    ctx.fillStyle=i===0?'#000':'#9ca3af'
    ctx.fillRect(s.x*size, s.y*size, size, size)
  }
  
  if(dir.x===0 && dir.y===0 && snake.length===1){
    ctx.fillStyle='rgba(255,255,255,0.8)'
    ctx.font='20px Inter, sans-serif'
    ctx.textAlign='center'
    ctx.fillText('Press Arrow Keys or WASD to Start', canvas.width/2, canvas.height/2 - 40)
  }
}

start()
</script>
</body>
</html>
